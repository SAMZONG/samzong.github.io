<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> HowTo Mount OSS Bucket On ECS · SAMZONG</title><meta name="description" content="HowTo Mount OSS Bucket On ECS - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">HowTo Mount OSS Bucket On ECS</h1><div class="post-info">Dec 20, 2016</div><div class="post-content"><blockquote>
<p>From <a href="https://github.com/aliyun/ossfs" target="_blank" rel="external">阿里云官方Github</a></p>
<p>Demo: CentOS 6.8 on ECS</p>
</blockquote>
<p>ossfs 是通过磁盘挂载的形式，将oss存储挂载到linux、类unix等操作系统，而且不仅仅可以挂载阿里云内的ECS上，理论上所有网络能到达oss的都可以挂载，但还是要以实际问题为准。</p>
<h5 id="1-Download-amp-Install"><a href="#1-Download-amp-Install" class="headerlink" title="1.Download &amp; Install"></a>1.Download &amp; Install</h5><p><a href="https://github.com/aliyun/ossfs/releases" target="_blank" rel="external">官方版本发布页面</a>，请根据你的系统类型进行选择，我这演示的环境是CentOS 6.8；ossfs目前最新的版本是v1.79.9，您可以根据自己当时版本进行选择，建议选择最新版本。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 请先将包上传到服务器上</div><div class="line"> <span class="selector-tag">sudo</span> <span class="selector-tag">yum</span> <span class="selector-tag">localinstall</span> <span class="selector-tag">ossfs_1</span><span class="selector-class">.79</span><span class="selector-class">.9_centos6</span><span class="selector-class">.5_x86_64</span><span class="selector-class">.rpm</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>注意使用localinstall，因为在安装过程，yum 可以很好的解决依赖关系，会节省我们很多时间</p>
</blockquote>
<h5 id="2-OSS-amp-Bucket"><a href="#2-OSS-amp-Bucket" class="headerlink" title="2. OSS &amp; Bucket"></a>2. OSS &amp; Bucket</h5><p> 需要获取以下信息，在后面我们都会用到的：<br></p>
<ol>
<li>Bucket 名称<br><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg" alt=""><br><br></li>
<li>Access Key ID</li>
<li>Access Key Secret<br><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png" alt=""></li>
</ol>
<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg" alt=""><br><br></p>
<ol>
<li>Location，这需要注意点，不要加上Bucket的名字，区域对应表如下，注意你的Bucket所在区域:<br><div><table><thead><tr><th style="color:green">Region中文名称</th><th style="text-align:left;color: green;">Region英文表示</th><th style="text-align:left;color: green;">外网Endpoint</th><th style="text-align:left;color: green;">ECS访问的内网Endpoint</th></tr></thead><tbody><tr><td>华东 1</td><td style="text-align:left">oss-cn-hangzhou</td><td style="text-align:left">oss-cn-hangzhou.aliyuncs.com</td><td style="text-align:left">oss-cn-hangzhou-internal.aliyuncs.com</td></tr><tr><td>华东 2</td><td style="text-align:left">oss-cn-shanghai</td><td style="text-align:left">oss-cn-shanghai.aliyuncs.com</td><td style="text-align:left">oss-cn-shanghai-internal.aliyuncs.com</td></tr><tr><td>华北 1</td><td style="text-align:left">oss-cn-qingdao</td><td style="text-align:left">oss-cn-qingdao.aliyuncs.com</td><td style="text-align:left">oss-cn-qingdao-internal.aliyuncs.com</td></tr><tr><td>华北 2</td><td style="text-align:left">oss-cn-beijing</td><td style="text-align:left">oss-cn-beijing.aliyuncs.com</td><td style="text-align:left">oss-cn-beijing-internal.aliyuncs.com</td></tr><tr><td>华南 1</td><td style="text-align:left">oss-cn-shenzhen</td><td style="text-align:left">oss-cn-shenzhen.aliyuncs.com</td><td style="text-align:left">oss-cn-shenzhen-internal.aliyuncs.com</td></tr><tr><td>香港数据中心</td><td style="text-align:left">oss-cn-hongkong</td><td style="text-align:left">oss-cn-hongkong.aliyuncs.com</td><td style="text-align:left">oss-cn-hongkong-internal.aliyuncs.com</td></tr><tr><td>美国硅谷数据中心</td><td style="text-align:left">oss-us-west-1</td><td style="text-align:left">oss-us-west-1.aliyuncs.com</td><td style="text-align:left">oss-us-west-1-internal.aliyuncs.com</td></tr><tr><td>美国弗吉尼亚数据中心</td><td style="text-align:left">oss-us-east-1</td><td style="text-align:left">oss-us-east-1.aliyuncs.com</td><td style="text-align:left">oss-us-east-1-internal.aliyuncs.com</td></tr><tr><td>亚太（新加坡）数据中心</td><td style="text-align:left">oss-ap-southeast-1</td><td style="text-align:left">oss-ap-southeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-southeast-1-internal.aliyuncs.com</td></tr><tr><td>亚太东北 1（日本）数据中心</td><td style="text-align:left">oss-ap-northeast-1</td><td style="text-align:left">oss-ap-northeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-northeast-1-internal.aliyuncs.com</td></tr></tbody></table></div><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 设置bucket/access key/id的信息，将其存放在/etc/passwd-ossfs 文件中</span></div><div class="line"><span class="comment"># 注意这个文件的权限必须正确设置，建议设为640</span></div><div class="line">sudo echo <span class="keyword">my</span>-bucket:<span class="keyword">my</span>-access-key-<span class="built_in">id</span>:<span class="keyword">my</span>-access-key-secret &gt; /etc/passwd-ossfs</div><div class="line">sudo chmod <span class="number">640</span> /etc/passwd-ossfs</div></pre></td></tr></table></figure>
</li>
</ol>
<p><br></p>
<h5 id="3-Mount-amp-Uasge"><a href="#3-Mount-amp-Uasge" class="headerlink" title="3. Mount &amp; Uasge"></a>3. Mount &amp; Uasge</h5><p>将oss bucket mount到指定目录:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 我碰到安装后找不到ossfs命令，查看下因为ossfs没有x权限，目录路径为/usr/local/bin，如果您也碰到这个问题，可以增加x权限后再测试</span></div><div class="line">sudo ossfs my-bucket <span class="regexp">/mnt/</span>ossdir -ourl=http:<span class="regexp">//</span>oss-location.aliyuncs.com</div><div class="line"></div><div class="line"><span class="comment"># 如果使用ossfs的机器是阿里云ECS，可以使用内网域名来避免流量收费和 提高速度：</span></div><div class="line">sudo ossfs my-bucket <span class="regexp">/tmp/</span>ossfs -ourl=http:<span class="regexp">//</span>oss-location-internal.aliyuncs.com</div></pre></td></tr></table></figure></p>
<p>磁盘空间达到上百T：<br><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0B78E099-5488-4839-AE48-09A074E7415D.png" alt=""><br><br></p>
<p> umount：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 注意用户身份</span></div><div class="line">umount /tmp/ossfs # root<span class="built_in"> user</span></div><div class="line">sudo fusermount -u /tmp/ossfs # non-root user</div></pre></td></tr></table></figure></p>
<p><br></p>
<h5 id="4-Debug-amp-FAQ"><a href="#4-Debug-amp-FAQ" class="headerlink" title="4. Debug &amp; FAQ"></a>4. Debug &amp; FAQ</h5><p>当遇到错误的时候，可以试着打开Debug日志信息，然后分析问题原因：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用 -o dbglevel=debug -f -d参数打印日志信息</span></div><div class="line">sudo ossfs my-bucket /tmp/ossfs <span class="attribute">-ourl</span>=http://oss-location-internal.aliyuncs.com -o <span class="attribute">dbglevel</span>=debug -f -d &gt; /mnt/ossfs.log 2&gt;&amp;1</div></pre></td></tr></table></figure></p>
<p>更多的问题，请移步查看<a href="https://github.com/aliyun/ossfs/wiki/FAQ" target="_blank" rel="external">官方的FAQ文档</a>。</p>
<p><br></p>
<h5 id="5-About"><a href="#5-About" class="headerlink" title="5. About"></a>5. About</h5><p>ossfs提供的功能和性能和本地文件系统相比，具有一些局限性。具体包括：</p>
<ul>
<li>随机或者追加写文件会导致整个文件的重写。</li>
<li>元数据操作，例如list directory，性能较差，因为需要远程访问oss服务器。</li>
<li>文件/文件夹的rename操作不是原子的。</li>
<li>多个客户端挂载同一个oss bucket时，依赖用户自行协调各个客户端的行为。例如避免多个客户端写同一个文件等等。</li>
<li>不支持hard link。</li>
<li>不适合用在高并发读/写的场景，这样会让系统的load升高</li>
</ul>
<blockquote>
<p>另外，ossfs的稳定性很大一部分依赖于网络环境，建议的使用场景更多是作为临时数据迁移或定期备份，虽然ossfs挂载到系统中会有着几百TB的空间，但是稳定性并不高。</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2017/01/07/docker-hub-guo-nei-jia-su/" class="prev">PREV</a><a href="/2016/12/17/shanghai-is-cold/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>