<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Tomcat(2) 利用JDK自身keytool实现HTTPS · SAMZONG</title><meta name="description" content="Tomcat(2) 利用JDK自身keytool实现HTTPS - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Tomcat(2) 利用JDK自身keytool实现HTTPS</h1><div class="post-info">Dec 3, 2016</div><div class="post-content"><p>因为一个偶然机会，想把自己的webserver通过https加密访问，这里就采用JDK自带的keytool工具实现，tomcat官方也推荐这种方式，英文好的同学走这里：<a href="https://tomcat.apache.org/tomcat-7.0-doc/ssl-howto.html" target="_blank" rel="external">官方配置</a></p>
<blockquote>
<p>demo: CentOS 6.6 &amp; Tomcat 7 &amp; JDK 1.7</p>
</blockquote>
<h4 id="1-生成-keystore"><a href="#1-生成-keystore" class="headerlink" title="1. 生成 keystore"></a>1. 生成 keystore</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@test conf]<span class="comment"># keytool -genkey -v -alias tomcat -keyalg RSA -keystore mykeystore</span></div><div class="line">Enter keystore password:              <span class="comment">#设置密码</span></div><div class="line">Re-enter new password:                <span class="comment">#重复一次</span></div><div class="line">What <span class="keyword">is</span> your <span class="keyword">first</span> <span class="keyword">and</span> <span class="keyword">last</span> <span class="built_in">name</span>?</div><div class="line">  [Unknown]:  Alex Lu                <span class="comment">#随便填</span></div><div class="line">What <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> your organizational unit?</div><div class="line">  [Unknown]:  visionet                <span class="comment">#随便填</span></div><div class="line">What <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> your organization?</div><div class="line">  [Unknown]:  visionet                <span class="comment">#随便填</span></div><div class="line">What <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> your City <span class="keyword">or</span> Locality?</div><div class="line">  [Unknown]:  SH                <span class="comment">#随便填</span></div><div class="line">What <span class="keyword">is</span> <span class="keyword">the</span> <span class="built_in">name</span> <span class="keyword">of</span> your State <span class="keyword">or</span> Province?</div><div class="line">  [Unknown]:  SH                <span class="comment">#随便填</span></div><div class="line">What <span class="keyword">is</span> <span class="keyword">the</span> two-letter country code <span class="keyword">for</span> this unit?</div><div class="line">  [Unknown]:  ZH                <span class="comment">#随便填</span></div><div class="line">Is CN=Alex Lu, OU=visionet, O=visionet, L=SH, ST=SH, C=ZH correct?</div><div class="line">  [no]:  Y                    <span class="comment">#这里要Y，确认前面信息。</span></div><div class="line"></div><div class="line">Generating <span class="number">2</span>,<span class="number">048</span> bit RSA key pair <span class="keyword">and</span> self-signed certificate (SHA256withRSA) <span class="keyword">with</span> a validity <span class="keyword">of</span> <span class="number">90</span> days</div><div class="line">    <span class="keyword">for</span>: CN=Alex Lu, OU=visionet, O=visionet, L=SH, ST=SH, C=ZH</div><div class="line">Enter key password <span class="keyword">for</span> &lt;tomcat&gt;</div><div class="line">    (RETURN <span class="keyword">if</span> same <span class="keyword">as</span> keystore password):        <span class="comment">#默认回车即可，不需要设置太多密码</span></div><div class="line">[Storing mykeystore]</div><div class="line">[root@test conf]<span class="comment"># ls</span></div><div class="line">Catalina  catalina.policy  catalina.properties  context.xml  logging.properties  mykeystore  server.xml  tomcat-users.xml  web.xml</div></pre></td></tr></table></figure>
<blockquote>
<p> 注意：-keystore是用来指定keystore保存位置，如果不加参数默认保存的当前用户家目录为~/.keystore<br>       -validity 可以用来指定证书有效期，单位为天，缺省值为90天。</p>
</blockquote>
<h4 id="2-备份-tomcatdir-conf-server-xml"><a href="#2-备份-tomcatdir-conf-server-xml" class="headerlink" title="2. 备份$tomcatdir/conf/server.xml"></a>2. 备份$tomcatdir/conf/server.xml</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp <span class="variable">$tomcatdir</span><span class="regexp">/conf/</span>server.xml <span class="variable">$tomcatdir</span><span class="regexp">/conf/</span>server.xml</div></pre></td></tr></table></figure>
<h4 id="3-修改server-xml"><a href="#3-修改server-xml" class="headerlink" title="3. 修改server.xml"></a>3. 修改server.xml</h4><h6 id="a-注释以下：（tomcat注释用：-lt-XXXX-）-如何也想保留http访问，可以不注释"><a href="#a-注释以下：（tomcat注释用：-lt-XXXX-）-如何也想保留http访问，可以不注释" class="headerlink" title="a. 注释以下：（tomcat注释用：&lt;!-- XXXX --> ）,如何也想保留http访问，可以不注释"></a>a. 注释以下：（tomcat注释用：&lt;!-- XXXX --> ）,如何也想保留http访问，可以不注释</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--</span></div><div class="line">&lt;Connector executor="tomcatThreadPool"</div><div class="line">                port="80" protocol="HTTP/1.1"</div><div class="line">                connectionTimeout="20000"</div><div class="line">                redirectPort="8443" /&gt;</div><div class="line">--&gt;</div></pre></td></tr></table></figure>
<h6 id="b-取消下面注释"><a href="#b-取消下面注释" class="headerlink" title="b. 取消下面注释"></a>b. 取消下面注释</h6><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Connector <span class="attribute">port</span>=<span class="string">"443"</span> <span class="attribute">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attribute">SSLEnabled</span>=<span class="string">"true"</span></div><div class="line">                <span class="attribute">maxThreads</span>=<span class="string">"150"</span> <span class="attribute">scheme</span>=<span class="string">"https"</span> <span class="attribute">secure</span>=<span class="string">"true"</span></div><div class="line">                <span class="attribute">clientAuth</span>=<span class="string">"false"</span> <span class="attribute">sslProtocol</span>=<span class="string">"TLS"</span> /&gt;</div></pre></td></tr></table></figure>
<h6 id="c-增加keystoreFile和keystorePass"><a href="#c-增加keystoreFile和keystorePass" class="headerlink" title="c. 增加keystoreFile和keystorePass"></a>c. 增加keystoreFile和keystorePass</h6><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Connector <span class="attribute">port</span>=<span class="string">"443"</span> <span class="attribute">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attribute">SSLEnabled</span>=<span class="string">"true"</span></div><div class="line">               <span class="attribute">maxThreads</span>=<span class="string">"150"</span> <span class="attribute">scheme</span>=<span class="string">"https"</span> <span class="attribute">secure</span>=<span class="string">"true"</span></div><div class="line">               <span class="attribute">clientAuth</span>=<span class="string">"false"</span> <span class="attribute">sslProtocol</span>=<span class="string">"TLS"</span></div><div class="line">               <span class="attribute">keystoreFile</span>=<span class="string">"conf/mykeystore"</span> <span class="attribute">keystorePass</span>=<span class="string">"123456"</span>/&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>keystoreFile=跟keystore文件位置<br>keystorePass=跟当时keytool命令执行时输入的密码</p>
</blockquote>
<h4 id="4-重启tomcat"><a href="#4-重启tomcat" class="headerlink" title="4. 重启tomcat"></a>4. 重启tomcat</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@<span class="keyword">test</span> conf]# ../bin/catalina.sh stop &amp;&amp; ../bin/catalina.sh start</div><div class="line">Using CATALINA_BASE:   /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span></div><div class="line">Using CATALINA_HOME:   /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span></div><div class="line">Using CATALINA_TMPDIR: /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span>/temp</div><div class="line">Using JRE_HOME:        /home/pms/jdk1<span class="meta">.7</span><span class="meta">.0_65</span></div><div class="line">Using CLASSPATH:       /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span>/bin/bootstrap.jar</div><div class="line">Using CATALINA_BASE:   /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span></div><div class="line">Using CATALINA_HOME:   /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span></div><div class="line">Using CATALINA_TMPDIR: /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span>/temp</div><div class="line">Using JRE_HOME:        /home/pms/jdk1<span class="meta">.7</span><span class="meta">.0_65</span></div><div class="line">Using CLASSPATH:       /home/pms/apache-tomcat-<span class="number">6.0</span><span class="meta">.44</span>/bin/bootstrap.jar</div><div class="line">[root@<span class="keyword">test</span> conf]# netstat -ntlup | grep -e <span class="string">"80\|443"</span></div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">80</span>         <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*          LISTEN      <span class="number">21960</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">443</span>        <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*          LISTEN      <span class="number">21960</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span>:<span class="number">8005</span>     <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*          LISTEN      <span class="number">21960</span>/java</div><div class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">8009</span>       <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*          LISTEN      <span class="number">21960</span>/java</div><div class="line">[root@<span class="keyword">test</span> conf]#</div></pre></td></tr></table></figure>
<p>OK !</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/12/04/wrbpvpam/" class="prev">PREV</a><a href="/2016/11/30/aws-s3-s3cmd-linux/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>