<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> HowTo Install MongoDB  on CentOS 6.x · SAMZONG</title><meta name="description" content="HowTo Install MongoDB  on CentOS 6.x - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">HowTo Install MongoDB  on CentOS 6.x</h1><div class="post-info">Mar 27, 2016</div><div class="post-content"><h2 id="1-Overiew"><a href="#1-Overiew" class="headerlink" title="1. Overiew"></a>1. Overiew</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在CentOS Linux 中安装软件的方式有很多种，我会在后续的文章中整理给大家，我比较喜欢的方式是尽量用Yum 安装，不用自己动手去解决软件包之间的依赖关系，“能Yum 就Yum ，不能Yum 想着法Yum 。”  – 这是我遵循的真理；今天给大家整理的就是如何使用Yum 来安装Mongodb ，在本文中会给出在32位与64位系统的区别，以及Mongodb 的版本，本文适用于CentOS 6/7 的Linux发行版本，所以同样适用于红帽体系的OS，如 RedHat Enterprise Linux 6/7 、 Fedora 。</p>
<h2 id="2-Packages"><a href="#2-Packages" class="headerlink" title="2. Packages"></a>2. Packages</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业内常用的Mongodb 的Yum 仓库有Mongodb-org 与 Mongodb-10gen ,这里提供的Mongodb-org 的repository 仓库，支持以下软件包列表：</p>
<ul>
<li><p>2.1 mongodb-org</p>
<p>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个是源数据包，主要是用来组织自动安装下面的4个软件包.</p>
</li>
<li><p>2.2 mongodb-org-sever</p>
<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个Mongodb Server端，包含了相关的配置和初始化脚本。</p>
</li>
<li><p>2.3 mongodb-org-mongos</p>
<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个是Mongodb的守护进程。</p>
</li>
<li><p>2.4 mongodb-org-shell</p>
<p>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个是mongodb 的shell环境。</p>
</li>
<li><p>2.5 mongodb-org-tools</p>
<p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个包里包含了下列mongodb 的工具：mongoimport bsondump, mongodump, mongoexport, mongofiles, mongooplog, mongoperf, mongorestore, mongostat, and mongotop 。</p>
</li>
</ul>
<h2 id="3-添加相对应版本的Mongodb-repo-file"><a href="#3-添加相对应版本的Mongodb-repo-file" class="headerlink" title="3. 添加相对应版本的Mongodb repo file."></a>3. 添加相对应版本的Mongodb repo file.</h2><h3 id="3-1-Mongodb-2-6-OS-x64"><a href="#3-1-Mongodb-2-6-OS-x64" class="headerlink" title="3.1 Mongodb 2.6 + OS x64"></a>3.1 Mongodb 2.6 + OS x64</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@vm02 ~]</span><span class="comment"># vim /etc/yum.repos.d/mongodb-org-2.6.repo</span></div><div class="line"><span class="section"></span></div><div class="line">[mongodb-org-2.6]</div><div class="line"><span class="attr">name</span>=MongoDB <span class="number">2.6</span> Repository</div><div class="line"><span class="attr">baseurl</span>=http://downloads-distro.mongodb.org/repo/redhat/os/x<span class="number">86_64</span>/</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="3-2-Mongodb-2-6-OS-i686"><a href="#3-2-Mongodb-2-6-OS-i686" class="headerlink" title="3.2 Mongodb 2.6 + OS i686"></a>3.2 Mongodb 2.6 + OS i686</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@vm02 ~]</span><span class="comment"># vim /etc/yum.repos.d/mongodb-org-2.6.repo</span></div><div class="line"><span class="section"></span></div><div class="line">[mongodb-org-2.6]</div><div class="line"><span class="attr">name</span>=MongoDB <span class="number">2.6</span> Repository</div><div class="line"><span class="attr">baseurl</span>=http://downloads-distro.mongodb.org/repo/redhat/os/i686/</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="3-3-Mongodb-3-2-OS-x64"><a href="#3-3-Mongodb-3-2-OS-x64" class="headerlink" title="3.3 Mongodb 3.2  + OS x64"></a>3.3 Mongodb 3.2  + OS x64</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@vm02 ~]</span><span class="comment"># vim /etc/yum.repos.d/mongodb-org-3.2.repo</span></div><div class="line"><span class="section"></span></div><div class="line">[mongodb-org-3.2]</div><div class="line"><span class="attr">name</span>=MongoDB Repository</div><div class="line"><span class="attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/<span class="number">3.2</span>/x<span class="number">86_64</span>/</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div></pre></td></tr></table></figure>
<h3 id="3-4-Mongodb-3-2-OS-i686"><a href="#3-4-Mongodb-3-2-OS-i686" class="headerlink" title="3.4 Mongodb 3.2  + OS i686"></a>3.4 Mongodb 3.2  + OS i686</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@vm02 ~]</span><span class="comment"># vim /etc/yum.repos.d/mongodb-org-3.2.repo</span></div><div class="line"><span class="section"></span></div><div class="line">[mongodb-org-3.2]</div><div class="line"><span class="attr">name</span>=MongoDB Repository</div><div class="line"><span class="attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/<span class="number">3.2</span>/i686/</div><div class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></div><div class="line"><span class="attr">enabled</span>=<span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="4-Install-MongoDB"><a href="#4-Install-MongoDB" class="headerlink" title="4. Install MongoDB"></a>4. Install MongoDB</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;安装最新版本的 Mongodb ，安装都方式一样，请注意安装相对应的源保证正确安装Mongodb，请使用如下命令：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@vm02</span> ~]<span class="meta"># yum clean all</span></div><div class="line">[root<span class="symbol">@vm02</span> ~]<span class="meta"># yum makecache</span></div><div class="line">[root<span class="symbol">@vm02</span> ~]<span class="meta"># yum install mongodb-org</span></div></pre></td></tr></table></figure>
<h2 id="5-Run-MongoDB"><a href="#5-Run-MongoDB" class="headerlink" title="5. Run MongoDB"></a>5. Run MongoDB</h2><h3 id="5-1-配置SELinux"><a href="#5-1-配置SELinux" class="headerlink" title="5.1 配置SELinux"></a>5.1 配置SELinux</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELinux 默认为开启状态，会导致我们的Mongodb 无法使用，解决方式有两种：</p>
<ol>
<li><a href="http://blog.ultraera.org/centos6-x-base-settings/" target="_blank" rel="external">关闭SELinux</a></li>
<li>添加Mongodb 通过SELinux 设定，指令如下：</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">semanage<span class="built_in"> port </span>-a -t mongod_port_t -p tcp 27017</div></pre></td></tr></table></figure>
<blockquote>
<p>Tips: 在CentOS 7 ，SELinux 会限定你去修改Mongodb的data目录及lib目录。</p>
</blockquote>
<h3 id="5-2-Start-MongoDB"><a href="#5-2-Start-MongoDB" class="headerlink" title="5.2 Start MongoDB"></a>5.2 Start MongoDB</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# sudo<span class="built_in"> service </span>mongod start</div><div class="line">Starting mongod:                                           [  OK  ]</div><div class="line">[root@vm02 ~]#</div></pre></td></tr></table></figure>
<h3 id="5-3-检查MongoDB日志文件验证服务正常启动，-var-log-mongodb-mongodb-log"><a href="#5-3-检查MongoDB日志文件验证服务正常启动，-var-log-mongodb-mongodb-log" class="headerlink" title="5.3 检查MongoDB日志文件验证服务正常启动， /var/log/mongodb/mongodb.log"></a>5.3 检查MongoDB日志文件验证服务正常启动， /var/log/mongodb/mongodb.log</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# cat /var/log/mongodb/mongod.log  # 看到如下内容表示mongodb启动成功了。</div><div class="line">2016-03-24T04:09:28.582+0800 I<span class="built_in"> NETWORK </span> [initandlisten] waiting <span class="keyword">for</span> connections on<span class="built_in"> port </span>27017</div></pre></td></tr></table></figure>
<h3 id="5-4-设置MongoDB-开机自启动"><a href="#5-4-设置MongoDB-开机自启动" class="headerlink" title="5.4 设置MongoDB 开机自启动"></a>5.4 设置MongoDB 开机自启动</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@vm02</span> ~]<span class="meta"># chkconfig mongod on</span></div></pre></td></tr></table></figure>
<h3 id="5-5-设置MongoDB-允许其他服务器访问"><a href="#5-5-设置MongoDB-允许其他服务器访问" class="headerlink" title="5.5 设置MongoDB 允许其他服务器访问"></a>5.5 设置MongoDB 允许其他服务器访问</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;默认情况下，mongodb 只监听 127.0.0.1 ，但是实际生产环境中可能需要其他服务器访问，所以这里添加监听其他网络端口，修改mongodb的配置文件：/etc/mongodb.conf</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[<span class="meta">root@vm02 ~</span>]<span class="meta"># vim /etc/mongodb.conf</span></div><div class="line"></div><div class="line"><span class="meta"># <span class="meta-keyword">line</span> 29 增加一行：</span></div><div class="line">    bindIp: <span class="number">172.16</span><span class="number">.102</span><span class="number">.129</span></div><div class="line"></div><div class="line"><span class="meta"># 注意不要把1270.0.1 去除，这会导致本地无法使用MongoDB .</span></div></pre></td></tr></table></figure>
<h2 id="6-Use-MongoDB"><a href="#6-Use-MongoDB" class="headerlink" title="6. Use MongoDB"></a>6. Use MongoDB</h2><h3 id="6-1-检查mongodb-状态"><a href="#6-1-检查mongodb-状态" class="headerlink" title="6.1 检查mongodb 状态"></a>6.1 检查mongodb 状态</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]#<span class="built_in"> service </span>mongod status</div><div class="line">mongod (pid 6502) is running<span class="built_in">..</span>.</div><div class="line">[root@vm02 ~]#</div></pre></td></tr></table></figure>
<h3 id="6-2-mongodb-自带检测工具"><a href="#6-2-mongodb-自带检测工具" class="headerlink" title="6.2 mongodb 自带检测工具"></a>6.2 mongodb 自带检测工具</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root<span class="meta">@vm02</span> ~]<span class="comment"># mongostat</span></div><div class="line">insert query update delete getmore command % dirty % used flushes  vsize   res qr|<span class="string">qw ar</span>|<span class="string">aw netIn netOut conn                      time</span></div><div class="line">    *0    *0     *0     *0       0     1|<span class="string">0     0.0    0.0       0 388.0M 68.0M   0</span>|<span class="string">0   0</span>|<span class="string">0   79b    18k    1 2016-03-24T04:25:09+08:00</span></div><div class="line">    *0    *0     *0     *0       0     1|<span class="string">0     0.0    0.0       0 388.0M 68.0M   0</span>|<span class="string">0   0</span>|<span class="string">0   79b    18k    1 2016-03-24T04:25:10+08:00</span></div><div class="line">    *0    *0     *0     *0       0     1|<span class="string">0     0.0    0.0       0 388.0M 68.0M   0</span>|<span class="string">0   0</span>|<span class="string">0   79b    18k    1 2016-03-24T04:25:11+08:00</span></div></pre></td></tr></table></figure>
<h3 id="6-3-进入mongodb-命令行模式"><a href="#6-3-进入mongodb-命令行模式" class="headerlink" title="6.3 进入mongodb 命令行模式"></a>6.3 进入mongodb 命令行模式</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# mongo</div><div class="line">MongoDB shell version: 3.2.4</div><div class="line">connecting to: test</div><div class="line">Server has startup warnings:</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten]</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is 'always'.</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten] **        We suggest setting it to 'never'</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten]</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is 'always'.</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten] **        We suggest setting it to 'never'</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten]</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 1024 processes, 64000 files. Number of processes should be at least 32000 : 0.5 times number of files.</div><div class="line">2016<span class="string">-03</span><span class="string">-24</span>T04:09:28.577<span class="string">+0800</span> I CONTROL  [initandlisten]</div><div class="line">&gt;</div></pre></td></tr></table></figure>
<h2 id="7-Uninstall-MongoDB"><a href="#7-Uninstall-MongoDB" class="headerlink" title="7. Uninstall MongoDB"></a>7. Uninstall MongoDB</h2><h3 id="7-1-关闭mongodb"><a href="#7-1-关闭mongodb" class="headerlink" title="7.1 关闭mongodb"></a>7.1 关闭mongodb</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]#<span class="built_in"> service </span>mongod stop</div></pre></td></tr></table></figure>
<h3 id="7-2-卸载mongodb-软件包"><a href="#7-2-卸载mongodb-软件包" class="headerlink" title="7.2 卸载mongodb 软件包"></a>7.2 卸载mongodb 软件包</h3><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@vm02</span> ~]<span class="meta"># yum erase $(rpm -qa | grep mongodb-org)</span></div></pre></td></tr></table></figure>
<h3 id="7-3-删除mongodb文件：数据库文件和日志文件"><a href="#7-3-删除mongodb文件：数据库文件和日志文件" class="headerlink" title="7.3 删除mongodb文件：数据库文件和日志文件"></a>7.3 删除mongodb文件：数据库文件和日志文件</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# <span class="keyword">rm</span> -rf /<span class="keyword">var</span>/<span class="keyword">log</span>/mongodb</div><div class="line">[root@vm02 ~]# <span class="keyword">rm</span> -rf /<span class="keyword">var</span>/lib/mongo</div></pre></td></tr></table></figure>
<h2 id="8-FAQ"><a href="#8-FAQ" class="headerlink" title="8. FAQ"></a>8. FAQ</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q : Mongodb 占用99%CPU并且查询速度很慢?</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A : 数据库需要首先建立索引，类似图书的目录文件，否则当你在数据库内查找数据的时候，就类似于在整本字典一页页翻查一个字如此。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/03/29/centos65shi-yong-createrepoda-jian-ben-di-yuan/" class="prev">PREV</a><a href="/2016/03/24/how-set-sftp-on-centos/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>