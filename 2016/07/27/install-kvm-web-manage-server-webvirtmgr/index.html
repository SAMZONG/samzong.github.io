<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> HowTo Install KVM Manage Server : webvirtmgr · SAMZONG</title><meta name="description" content="HowTo Install KVM Manage Server : webvirtmgr - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">HowTo Install KVM Manage Server : webvirtmgr</h1><div class="post-info">Jul 27, 2016</div><div class="post-content"><p>生产环境的KVM宿主机越来越多，需要对宿主机的状态进行调控。这里用webvirtmgr进行管理。图形化的WEB，让人能更方便的查看kvm 宿主机的情况和操作.</p>
<p><strong><em><a href="https://github.com/retspen/webvirtmgr" target="_blank" rel="external">GitHub Project.</a></em></strong></p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><h4 id="安装支持的软件源"><a href="#安装支持的软件源" class="headerlink" title="安装支持的软件源"></a>安装支持的软件源</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> -y epel-<span class="keyword">release</span></div></pre></td></tr></table></figure>
<h4 id="安装相关软件"><a href="#安装相关软件" class="headerlink" title="安装相关软件"></a>安装相关软件</h4><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install git <span class="keyword">python</span>-pip libvirt-<span class="keyword">python</span> libxml2-<span class="keyword">python</span> <span class="keyword">python</span>-websockify supervisor nginx</div></pre></td></tr></table></figure>
<h4 id="从git-hub中下载相关的webvirtmgr代码"><a href="#从git-hub中下载相关的webvirtmgr代码" class="headerlink" title="从git-hub中下载相关的webvirtmgr代码"></a>从git-hub中下载相关的webvirtmgr代码</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/src/</span></div><div class="line">git clone git:<span class="regexp">//gi</span>thub.com<span class="regexp">/retspen/</span>webvirtmgr.git</div></pre></td></tr></table></figure>
<h4 id="安装webvirtmgr"><a href="#安装webvirtmgr" class="headerlink" title="安装webvirtmgr"></a>安装webvirtmgr</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> webvirtmgr/</div><div class="line">pip install -r requirements.txt</div></pre></td></tr></table></figure>
<h4 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> python-sqlite2</div></pre></td></tr></table></figure>
<h4 id="对django进行环境配置"><a href="#对django进行环境配置" class="headerlink" title="对django进行环境配置"></a>对django进行环境配置</h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">./manage.py syncdb</div><div class="line"></div><div class="line">You just installed Django<span class="string">'s auth system, which means you don'</span>t have any superusers <span class="keyword">defined</span>.</div><div class="line">Would you like to create one now? (yes/no): yes</div><div class="line">Username (leave blank to <span class="keyword">use</span> <span class="string">'root'</span>): admin</div><div class="line">Email <span class="symbol">address:</span> luchuanjia<span class="variable">@msn</span>.com</div><div class="line"><span class="symbol">Password:</span>*********</div><div class="line">Password (again)<span class="symbol">:*********</span></div><div class="line"></div><div class="line">./manage.py collectstatic <span class="comment">#生成配置文件</span></div><div class="line">./manage.py createsuperuser <span class="comment">#添加管理员账号</span></div></pre></td></tr></table></figure>
<h4 id="拷贝web到-相关目录"><a href="#拷贝web到-相关目录" class="headerlink" title="拷贝web到 相关目录"></a>拷贝web到 相关目录</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> ..</div><div class="line"><span class="keyword">rm</span> -rf /<span class="keyword">var</span>/www</div><div class="line"><span class="keyword">mkdir</span> -pv /<span class="keyword">var</span>/www</div><div class="line">cp -Rv webvirtmgr /<span class="keyword">var</span>/www/webvirtmgr</div></pre></td></tr></table></figure>
<h4 id="设置ssh"><a href="#设置ssh" class="headerlink" title="设置ssh"></a>设置ssh</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">ssh-keygen</span></div><div class="line"><span class="selector-tag">ssh-copy-id</span> 192<span class="selector-class">.168</span><span class="selector-class">.2</span><span class="selector-class">.32</span></div><div class="line"><span class="selector-tag">ssh</span> 192<span class="selector-class">.168</span><span class="selector-class">.2</span><span class="selector-class">.32</span> <span class="selector-tag">-L</span> <span class="selector-tag">localhost</span><span class="selector-pseudo">:8000</span><span class="selector-pseudo">:localhost</span><span class="selector-pseudo">:8000</span> <span class="selector-tag">-L</span> <span class="selector-tag">localhost</span><span class="selector-pseudo">:6080</span><span class="selector-pseudo">:localhost</span><span class="selector-pseudo">:6080</span></div></pre></td></tr></table></figure>
<h4 id="编辑nginx配置文件"><a href="#编辑nginx配置文件" class="headerlink" title="编辑nginx配置文件"></a>编辑nginx配置文件</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">mv</span> /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak</div><div class="line">vim /etc/nginx/conf.d/webvirtmgr.conf  <span class="comment">#添加下面内容到文件中</span></div><div class="line"></div><div class="line">server &#123;</div><div class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</div><div class="line"></div><div class="line">    <span class="attribute">server_name</span> <span class="variable">$hostname</span>;</div><div class="line">    <span class="comment">#access_log /var/log/nginx/webvirtmgr_access_log;</span></div><div class="line"></div><div class="line">    <span class="attribute">location</span> /static/ &#123;</div><div class="line">        <span class="attribute">root</span> /var/www/webvirtmgr/webvirtmgr; <span class="comment"># or /srv instead of /var</span></div><div class="line">        <span class="attribute">expires</span> max;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8000;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-for <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">600</span>;</div><div class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">600</span>;</div><div class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">600</span>;</div><div class="line">        <span class="attribute">client_max_body_size</span> <span class="number">1024M</span>; <span class="comment"># Set higher depending on your needs</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service nginx <span class="literal">start</span></div></pre></td></tr></table></figure>
<h4 id="修改防火墙规则-如果关闭selinux，此步可省略"><a href="#修改防火墙规则-如果关闭selinux，此步可省略" class="headerlink" title="修改防火墙规则 ( 如果关闭selinux，此步可省略)"></a>修改防火墙规则 ( 如果关闭selinux，此步可省略)</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">/usr/sbin/setsebool</span> httpd_can_network_<span class="keyword">connect</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
<h4 id="设置-supervisor"><a href="#设置-supervisor" class="headerlink" title="设置 supervisor"></a>设置 supervisor</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">chown -R nginx:nginx /var/www/webvirtmgr</div><div class="line">vim /etc/supervisord.conf <span class="comment">#在文件末尾添加</span></div><div class="line"></div><div class="line"><span class="section">[program:webvirtmgr]</span></div><div class="line">command=/usr/bin/python /var/www/webvirtmgr/manage.py run_gunicorn -c /var/www/webvirtmgr/conf/gunicorn.conf.py</div><div class="line">directory=/var/www/webvirtmgr</div><div class="line">autostart=true</div><div class="line">autorestart=true</div><div class="line">logfile=/var/log/supervisor/webvirtmgr.log</div><div class="line">log_stderr=true</div><div class="line">user=nginx</div><div class="line"></div><div class="line"><span class="section">[program:webvirtmgr-console]</span></div><div class="line">command=/usr/bin/python /var/www/webvirtmgr/console/webvirtmgr-console</div><div class="line">directory=/var/www/webvirtmgr</div><div class="line">autostart=true</div><div class="line">autorestart=true</div><div class="line">stdout_logfile=/var/log/supervisor/webvirtmgr-console.log</div><div class="line">redirect_stderr=true</div><div class="line">user=nginx</div><div class="line"></div><div class="line">修改/var/www/webvirtmgr/conf/gunicorn.conf.py</div><div class="line">bind = <span class="string">"0:8000"</span></div></pre></td></tr></table></figure>
<h4 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig supervisord <span class="keyword">on</span></div><div class="line">chkconfig nginx <span class="keyword">on</span></div><div class="line">vim /etc/rc.<span class="keyword">local</span></div><div class="line">      /usr/sbin/setsebool httpd_can_network_connect <span class="literal">true</span></div></pre></td></tr></table></figure>
<h4 id="启动进程"><a href="#启动进程" class="headerlink" title="启动进程"></a>启动进程</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">service nginx start<span class="built_in"></span></div><div class="line">service supervisord start</div></pre></td></tr></table></figure>
<h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span><span class="variable">$server_ip</span><span class="regexp">/login/</span></div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/07/29/trun-off-ipv6/" class="prev">PREV</a><a href="/2016/07/27/centosxia-yumzhong-releaseverhe-basearchde-qu-zhi/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>