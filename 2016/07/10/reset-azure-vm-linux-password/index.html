<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> HowTo Reset Azure VM Linux Password · SAMZONG</title><meta name="description" content="HowTo Reset Azure VM Linux Password - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">HowTo Reset Azure VM Linux Password</h1><div class="post-info">Jul 10, 2016</div><div class="post-content"><blockquote>
<p>  <strong>Setup1:</strong> 这种方法仅适用于已存在的用户，也就是说$Username是之前创建过的用户，否则不适用</p>
</blockquote>
<h3 id="1-指定虚拟机"><a href="#1-指定虚拟机" class="headerlink" title="1. 指定虚拟机"></a><strong>1. 指定虚拟机</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">vm = Get-AzureVM -ServiceName <span class="string">'云服务名称'</span> -Name <span class="string">'虚拟机名称'</span></span></div><div class="line"><span class="meta">$</span><span class="bash">vm.GetInstance().ProvisionGuestAgent = <span class="variable">$true</span></span></div></pre></td></tr></table></figure>
<h3 id="2-输入您当前的用户名和新密码"><a href="#2-输入您当前的用户名和新密码" class="headerlink" title="2. 输入您当前的用户名和新密码"></a><strong>2. 输入您当前的用户名和新密码</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">UserName = <span class="string">"指定用户名"</span></span></div><div class="line"><span class="meta">$</span><span class="bash">Password = <span class="string">"指定密码"</span></span></div><div class="line"><span class="meta"></span></div><div class="line">$<span class="bash">PrivateConfig = <span class="string">'&#123;"username":"'</span>+ <span class="variable">$UserName</span> + <span class="string">'", "password":"'</span> +  <span class="variable">$Password</span> + <span class="string">'"&#125;'</span></span></div></pre></td></tr></table></figure>
<h3 id="3-开始执行"><a href="#3-开始执行" class="headerlink" title="3. 开始执行"></a><strong>3. 开始执行</strong></h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ExtensionName = <span class="string">'VMAccessForLinux'</span></div><div class="line">$Publisher = <span class="string">'Microsoft.OSTCExtensions'</span></div><div class="line">$Version =  <span class="string">'1.0'</span></div><div class="line"></div><div class="line"><span class="built_in">Set</span><span class="params">-AzureVMExtension</span> <span class="params">-ExtensionName</span> $ExtensionName <span class="params">-VM</span>  $vm <span class="params">-Publisher</span> $Publisher <span class="params">-Version</span> $Version <span class="params">-PrivateConfiguration</span> $PrivateConfig | Update<span class="params">-AzureVM</span></div></pre></td></tr></table></figure>
<blockquote>
<p><strong>Setup2:</strong> 如果是由于错误修改了SSH的配置文件导致无法登录，例如在登录时报错：This service allows sftp connections only.Connection to vm closed.这是因为错误配置了sftp导致的，那碰到这种问题需要做的是重置ssh服务。</p>
</blockquote>
<h3 id="1-指定虚拟机-1"><a href="#1-指定虚拟机-1" class="headerlink" title="1. 指定虚拟机"></a><strong>1. 指定虚拟机</strong></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">vm = Get-AzureVM -ServiceName <span class="string">'MyServiceName'</span> -Name <span class="string">'MyVMName'</span></span></div><div class="line"><span class="meta">$</span><span class="bash">PrivateConfig = <span class="string">'&#123;"reset_ssh":"True"&#125;'</span><span class="string">'</span></span></div></pre></td></tr></table></figure>
<h3 id="2-开始执行"><a href="#2-开始执行" class="headerlink" title="2. 开始执行"></a><strong>2. 开始执行</strong></h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ExtensionName = <span class="string">'VMAccessForLinux'</span></div><div class="line">$Publisher = <span class="string">'Microsoft.OSTCExtensions'</span></div><div class="line">$Version =  <span class="string">'1.0'</span></div><div class="line"></div><div class="line"><span class="built_in">Set</span><span class="params">-AzureVMExtension</span> <span class="params">-ExtensionName</span> $ExtensionName <span class="params">-VM</span>  $vm <span class="params">-Publisher</span> $Publisher <span class="params">-Version</span> $Version <span class="params">-PrivateConfiguration</span> $PrivateConfig | Update<span class="params">-AzureVM</span></div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/07/23/hey-friends-2/" class="prev">PREV</a><a href="/2016/07/07/how-to-install-docker-on-centos-6-x-2/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>