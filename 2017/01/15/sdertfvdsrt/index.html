<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 每日备份MySQL单表数据 · SAMZONG</title><meta name="description" content="每日备份MySQL单表数据 - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">每日备份MySQL单表数据</h1><div class="post-info">Jan 15, 2017</div><div class="post-content"><p>最近愈近年底，客户业务涉及对账操作，所以同事提出需求需要单独备份某张表数据，并且每日备份；思考之后解决办法如下：</p>
<ol>
<li>mysqldump导出单张表的表结构及数据</li>
<li>新增数据库，专做临时每日数据备份库</li>
<li>导入该表数据到新增数据库内</li>
<li>重命名导入的表名（预防计划任务下次导入时数据覆盖）</li>
<li>编写脚本，添加Linux计划任务</li>
</ol>
<h4 id="1-mysqldump导出但张表的表结构及数据"><a href="#1-mysqldump导出但张表的表结构及数据" class="headerlink" title="1. mysqldump导出但张表的表结构及数据"></a>1. mysqldump导出但张表的表结构及数据</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqldump -h dbServer -PdbServerPort -u db_user -<span class="selector-tag">p</span> -d dbName tbName &gt; tbName.sql</div></pre></td></tr></table></figure>
<h4 id="2-新增数据库，专做临时每日数据备份库"><a href="#2-新增数据库，专做临时每日数据备份库" class="headerlink" title="2. 新增数据库，专做临时每日数据备份库"></a>2. 新增数据库，专做临时每日数据备份库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> loginTo your DBserver</span></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database bakdbName character <span class="built_in">set</span> utf8;</span></div></pre></td></tr></table></figure>
<h4 id="3-导入该表数据到新增数据库内"><a href="#3-导入该表数据到新增数据库内" class="headerlink" title="3. 导入该表数据到新增数据库内"></a>3. 导入该表数据到新增数据库内</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -h dbServer -P dbServerPort -u db_user -<span class="selector-tag">p</span> bakdbName &lt; tbName.sql</div></pre></td></tr></table></figure>
<h4 id="4-重命名导入的表名"><a href="#4-重命名导入的表名" class="headerlink" title="4 . 重命名导入的表名"></a>4 . 重命名导入的表名</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -u db_user -p -e "<span class="keyword">rename</span> <span class="keyword">table</span> bakdbName.tbName <span class="keyword">to</span> bakdbName.tbName_$<span class="built_in">DATE</span><span class="string">"</span></div></pre></td></tr></table></figure>
<h4 id="5-编写脚本"><a href="#5-编写脚本" class="headerlink" title="5. 编写脚本"></a>5. 编写脚本</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[root@testServer01 ~]# cat /usr/local/bin/bakTable.sh</div><div class="line"><span class="comment">#!/bin/bash</span></div><div class="line"></div><div class="line"><span class="comment">#Create by SAMZONG</span></div><div class="line"></div><div class="line"><span class="attribute">DATE</span>=`date +%Y%m%d`</div><div class="line"><span class="attribute">TMPDIR</span>=/tmp/baksql</div><div class="line"></div><div class="line"><span class="comment"># modify your DB configure</span></div><div class="line"><span class="attribute">DBSERVER1</span>=localhost</div><div class="line"><span class="attribute">DBSERVER1_PORT</span>=3306</div><div class="line"><span class="attribute">DBSERVER1_USER</span>=root</div><div class="line"><span class="attribute">DBSERVER1_PASSWORD</span>=password</div><div class="line"><span class="attribute">MASTER_DBNAME</span>=zabbix</div><div class="line"><span class="attribute">MASTER_TBNAME</span>=users</div><div class="line"></div><div class="line"><span class="attribute">DBSERVER2</span>=localhost</div><div class="line"><span class="attribute">DBSERVER2_PORT</span>=3306</div><div class="line"><span class="attribute">DBSERVER2_USER</span>=root</div><div class="line"><span class="attribute">DBSERVER2_PASSWORD</span>=password</div><div class="line"><span class="attribute">BAKDBNAME</span>=z3</div><div class="line"></div><div class="line"><span class="comment"># creat tmp folder</span></div><div class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$TMPDIR</span> ]; then</div><div class="line">	mkdir <span class="variable">$TMPDIR</span></div><div class="line">fi</div><div class="line"></div><div class="line"><span class="comment"># dump tbName</span></div><div class="line">mysqldump -h <span class="variable">$DBSERVER1</span> -P <span class="variable">$DBSERVER1_PORT</span> -u <span class="variable">$DBSERVER1_USER</span> -p<span class="string">"<span class="variable">$DBSERVER1_PASSWORD</span>"</span> -d <span class="variable">$MASTER_DBNAME</span>  <span class="variable">$MASTER_TBNAME</span> &gt; <span class="variable">$TMPDIR</span>/<span class="variable">$MASTER_TBNAME</span>.sql</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># insert tbNAME to bakdbName</span></div><div class="line"><span class="keyword">if</span> [ $? -eq 0  ]; then</div><div class="line">	mysql -h <span class="variable">$DBSERVER2</span> -P <span class="variable">$DBSERVER2_PORT</span> -u <span class="variable">$DBSERVER2_USER</span> -p<span class="string">"<span class="variable">$DBSERVER2_PASSWORD</span>"</span> <span class="variable">$BAKDBNAME</span> &lt; <span class="variable">$TMPDIR</span>/<span class="variable">$MASTER_TBNAME</span>.sql</div><div class="line"></div><div class="line">	<span class="keyword">if</span> [ $? -eq 0 ]; then</div><div class="line">		# rename tbName</div><div class="line">		mysql -h <span class="variable">$DBSERVER2</span> -P <span class="variable">$DBSERVER2_PORT</span> -u <span class="variable">$DBSERVER2_USER</span> -p<span class="string">"<span class="variable">$DBSERVER2_PASSWORD</span>"</span> -e <span class="string">"rename table "</span><span class="variable">$BAKDBNAME</span><span class="string">"."</span><span class="variable">$MASTER_TBNAME</span><span class="string">" to "</span><span class="variable">$BAKDBNAME</span><span class="string">"."</span><span class="variable">$MASTER_TBNAME</span><span class="string">"_"</span><span class="variable">$DATE</span><span class="string">";"</span></div><div class="line">	fi</div><div class="line"></div><div class="line">fi</div></pre></td></tr></table></figure>
<h4 id="6-添加到Linux计划任务"><a href="#6-添加到Linux计划任务" class="headerlink" title="6. 添加到Linux计划任务"></a>6. 添加到Linux计划任务</h4><figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">00 </span><span class="number">00</span> * * * /<span class="keyword">usr</span>/local/bin/bakTable.sh</div></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/01/18/zabbix01-monitor-tomcat-head-memory-jmx/" class="prev">PREV</a><a href="/2017/01/15/si-ren-ruo-cai-hong/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>