<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> CentOS 7 Configure DNS Server · SAMZONG</title><meta name="description" content="CentOS 7 Configure DNS Server - SAMZONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://samzong.me/atom.xml" title="SAMZONG"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">CentOS 7 Configure DNS Server</h1><div class="post-info">Sep 13, 2017</div><div class="post-content"><p>今天介绍下如何在CentOS 7下部署DNS Server，测试环境中服务端搭建在了CentOS 7，客户端分别在Windows和Linux实现测试。</p>
<p>因为目的是让自建DNS服务器解析公司内部的自定义域名，所以当客户端需要访问外网域名时，DNS服务器会将解析请求转发给ISP的DNS服务器，并会将解析结果缓存，并且只对内网主机的解析请求进行转发，而不会对公网的主机解析请求进行转发。</p>
<h4 id="DNS服务介绍"><a href="#DNS服务介绍" class="headerlink" title="DNS服务介绍"></a>DNS服务介绍</h4><p>DNS服务由BIND提供，启动后服务名为<code>named</code>，管理工具为<code>rndc</code>，debug工具为<code>dig</code>，主要配置文件在<code>/etc/named.conf</code>。</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>推荐选择<code>bind-chroot</code>来安装，提高服务的安全性：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">➜  ~ yum install -y bind-chroot</div></pre></td></tr></table></figure></p>
<p>安装完成之后，启动<code>named-chroot</code>服务，并设置为开机自启动：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  ~ systemctl enable named-chroot.service</div><div class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to /usr/lib/systemd/system/named-chroot.service.</div><div class="line">➜  ~ systemctl start named-chroot.service</div><div class="line">➜  ~ netstat -ntlp | grep 53</div><div class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      4515/named</div><div class="line">tcp        0      0 127.0.0.1:953           0.0.0.0:*               LISTEN      4515/named</div></pre></td></tr></table></figure></p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>首先备份DNS服务端的主配置文件，然后修改其中的内容：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">➜  ~ cp /etc/named.conf /etc/named.conf.bak</div><div class="line">➜  ~ vim /etc/named.conf</div><div class="line"></div><div class="line">options &#123;</div><div class="line">        listen-on port 53 &#123; any; &#125;;</div><div class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</div><div class="line">        directory       "/var/named";</div><div class="line">        dump-file       "/var/named/data/cache_dump.db";</div><div class="line">        statistics-file "/var/named/data/named_stats.txt";</div><div class="line">        memstatistics-file "/var/named/data/named_mem_stats.txt";</div><div class="line">        </div><div class="line">        allow-query     &#123; 192.168.16.0/24; 192.168.0.0/23; &#125;;</div><div class="line">        recursion yes;</div><div class="line">        allow-recursion &#123; 192.168.16.0/24; 192.168.0.0/23; &#125;;</div><div class="line">        </div><div class="line">        forward first;</div><div class="line">        forwarders &#123; 202.96.209.133; 114.114.114.114; &#125;;</div><div class="line">        </div><div class="line">        dnssec-enable no;</div><div class="line">        dnssec-validation no;</div><div class="line">        dnssec-lookaside no;</div><div class="line"></div><div class="line">        bindkeys-file "/etc/named.iscdlv.key";</div><div class="line">        managed-keys-directory "/var/named/dynamic";</div><div class="line"></div><div class="line">        pid-file "/run/named/named.pid";</div><div class="line">        session-keyfile "/run/named/session.key";</div><div class="line">&#125;;</div><div class="line"></div><div class="line">logging &#123;</div><div class="line">        channel default_debug &#123;</div><div class="line">                file "data/named.run";</div><div class="line">                severity dynamic;</div><div class="line">        &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">zone "." IN &#123;</div><div class="line">        type hint;</div><div class="line">        file "named.ca";</div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 新增一个samzong.local域名.</div><div class="line">zone "samzong.local" IN &#123;</div><div class="line">    type master;</div><div class="line">    file "samzong.local.zone";</div><div class="line">&#125;;</div><div class="line"></div><div class="line">include "/etc/named.rfc1912.zones";</div><div class="line">include "/etc/named.root.key";</div></pre></td></tr></table></figure></p>
<h4 id="编辑samzong-local-zone配置文件"><a href="#编辑samzong-local-zone配置文件" class="headerlink" title="编辑samzong.local.zone配置文件"></a>编辑samzong.local.zone配置文件</h4><p>首先创建samzong.local.zone文件：<br><figure class="highlight irpf90"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">➜  ~ cd /var/<span class="keyword">named</span></div><div class="line">➜  <span class="keyword">named</span> <span class="keyword">touch</span> samzong.local.zone;</div></pre></td></tr></table></figure></p>
<p>然后编辑文件内容新增：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">TTL 86400</span></div><div class="line">@ IN SOA @ root.samzong.local. (</div><div class="line">    2016042112 ;Serial</div><div class="line">    3600 ;Refresh</div><div class="line">    1800 ;Retry</div><div class="line">    604800 ;Expire</div><div class="line">    43200 ;Minimum TTL</div><div class="line">)</div><div class="line"></div><div class="line">        NS  @</div><div class="line">        A       10.0.2.6</div><div class="line">www     A       192.168.16.100</div><div class="line">a   IN  CNAME   www.baidu.com.</div><div class="line">b       A       192.168.16.101</div></pre></td></tr></table></figure></p>
<p>编辑完成之后，重新启动named-chroot让服务生效：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">➜  named systemctl restart named-chroot.service</div></pre></td></tr></table></figure></p>
<h4 id="客户端验证"><a href="#客户端验证" class="headerlink" title="客户端验证"></a>客户端验证</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">➜  named nslookup www.samzong.local</div><div class="line">Server:		192.168.16.6</div><div class="line">Address:	192.168.16.6#53</div><div class="line"></div><div class="line">Name:	www.samzong.local</div><div class="line">Address: 192.168.16.100</div></pre></td></tr></table></figure>
<h4 id="使用rndc管理DNS解析记录"><a href="#使用rndc管理DNS解析记录" class="headerlink" title="使用rndc管理DNS解析记录"></a>使用rndc管理DNS解析记录</h4><p>rndc 常用指令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">status          显示bind服务器的工作状态</div><div class="line">reload          重新加载配置文件和区域文件</div><div class="line">reload zone     重新加载指定的zone</div><div class="line">reconfig        重新读取配制间并加载新增的zone</div><div class="line">querylog        关闭或开启查询日志</div><div class="line">dumpdb          将高速缓存转存到文件,named.conf 有指定文件位置</div><div class="line">freeze          暂停更新所有zone状态</div></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/11/15/howto-user-ssr-on-mac/" class="prev">PREV</a><a href="/2017/08/22/mac-recoding-gif/" class="next">NEXT</a></div><div class="copyright"><p>© 2012 - 2017 <a href="https://samzong.me">SAMZONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>